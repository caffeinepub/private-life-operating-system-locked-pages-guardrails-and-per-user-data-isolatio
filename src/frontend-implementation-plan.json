{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Audit and fix routing/auth flows, Focus Mode completion, and Weekly Reset task clearing (frontend-only)",
  "requirements": [
    {
      "id": "REQ-19",
      "summary": "Audit core user flows end-to-end and fix broken navigation, runtime errors, and dead-end UI states across the existing pages.",
      "acceptanceCriteria": [
        "A new user can reach /login directly and log in without router errors.",
        "After login, if no user profile exists, the app shows onboarding and then routes to /dump after onboarding completion.",
        "Bottom navigation works and routes correctly between Dashboard, Dump, Clarify, Projects, Reset for an authenticated user.",
        "No page renders a blank screen due to an uncaught exception during normal use of the above flows."
      ],
      "file_operations": [
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Harden app-level flow wiring discovered during audit: ensure onboarding gating only runs after profile query is actually fetched, and add safe rendering/loading states where needed to avoid blank screens on transient auth/actor/profile states. Use the authorization component guidance for profile gating and auth state handling; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/ClarifyPage.tsx",
          "operation": "modify",
          "description": "Replace the current 'return null' dead-end state when there are no mind dumps with a non-blank UI (e.g., a short message + redirect action or an immediate Navigate-based redirect) so the user never sees a blank screen during normal navigation."
        },
        {
          "path": "frontend/src/pages/LoginPage.tsx",
          "operation": "modify",
          "description": "Ensure the login screen always renders reliably (no dependence on authenticated route tree) and improve error handling display for failed login attempts (keep text in English). Use the authorization component guidance for login/logout and cached data clearing expectations; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/public/assets/generated/life-os-icon.dim_512x512.png",
          "operation": "create",
          "description": "Add the generated icon asset at the exact path referenced by the Login page (frontend/public/assets/generated/life-os-icon.dim_512x512.png) so it loads consistently in all environments."
        }
      ]
    },
    {
      "id": "REQ-20",
      "summary": "Fix TanStack Router route tree so guest-only /login is active and does not conflict with authenticated route guarding.",
      "acceptanceCriteria": [
        "Navigating to /login while logged out renders the Login page UI.",
        "Navigating to any authenticated route (/, /dump, /clarify, /projects, /reset, /profile) while logged out redirects to /login.",
        "Navigating to /login while logged in redirects to /."
      ],
      "file_operations": [
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Refactor TanStack Router configuration to use a single active root route tree that includes both guest-only and authenticated routes. Ensure /login is a child of the active tree under a guest guard (RequireGuest), and ensure authenticated routes are under an auth guard (RequireAuth) so redirects work correctly in both directions. Use the authorization component guidance for authenticated gating/redirect behavior; verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-21",
      "summary": "Implement Focus Mode task completion so “Mark Done” persists and the Dashboard updates immediately after exiting Focus Mode.",
      "acceptanceCriteria": [
        "Clicking “Mark Done” in Focus Mode updates the corresponding Task.status to completed in persistent backend state.",
        "After marking done and exiting Focus Mode, the task no longer appears in the Dashboard pending task list.",
        "The update is scoped to the authenticated user; a user cannot mark another user’s task as done (backend enforces ownership)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add a React Query mutation hook for marking a task done (using the existing backend capability) and invalidate/refresh task queries used by the Dashboard so UI reflects completion immediately. Use the authorization component guidance for handling authorization failures and showing user-friendly errors; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/FocusMode.tsx",
          "operation": "modify",
          "description": "Wire “Mark Done” to call the new mark-done mutation (or accept a callback from the parent that performs the mutation) and provide pending/disabled state + error feedback so users can’t accidentally exit before the update completes."
        },
        {
          "path": "frontend/src/pages/DashboardPage.tsx",
          "operation": "modify",
          "description": "Integrate Focus Mode completion flow: pass the selected task into FocusMode and ensure exiting Focus Mode after marking done results in the Dashboard task list being refreshed (via query invalidation or immediate local removal) so the completed task no longer appears in pending tasks."
        }
      ]
    },
    {
      "id": "REQ-22",
      "summary": "Implement “Close this week & reset” to clear the user’s daily tasks as part of Weekly Reset, in addition to saving the weekly review.",
      "acceptanceCriteria": [
        "Submitting Weekly Reset persists the weekly review and then clears the authenticated user’s current tasks for the new week (per product intent).",
        "After a weekly reset, the Dashboard shows no pending tasks for that user.",
        "The reset operation only affects the authenticated user’s data; it cannot clear other users’ tasks (backend enforces ownership)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add a React Query mutation hook for weekly task reset (using the existing backend capability) and ensure it invalidates task queries so the Dashboard reflects cleared tasks immediately after reset. Use the authorization component guidance for handling authorization failures and showing user-friendly errors; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/WeeklyResetPage.tsx",
          "operation": "modify",
          "description": "Update the reset submission flow to (1) save the weekly review, then (2) run the weekly reset task-clearing mutation, then (3) navigate back to the Dashboard. Ensure UI handles pending states and failures gracefully (English text) and triggers task query refresh so the Dashboard shows no pending tasks."
        }
      ]
    }
  ]
}